cgrep.doc	ver. 3.01					92/05/03

名前
	cgrep - context grep

起動
	cgrep [-CGHSVabchilnstvwx] [-Z[{c,d}]] [-M[{u,h}]] [-N <field>] [-T<separator>] [-ABFW[<num>]] [-<num>] [-f file] [-e] expr file...

説明
	ファイルを grep します。

	検索パターンは GNU の egrep に倣った正規表現が使えます。
	複数の検索パターンを指定して OR、AND 検索ができます。
	エスケープシーケンスとして \s、\t、\0ooo、\xhh が使えます。

	環境変数 CGREP に REGEX:GREP; を設定するか、ファイル cgrep.cfg に
	REGEX=GREP を設定すると GNU の grep に倣った正規表現が使えます。

	入力ファイル名が指定されていないか、入力ファイル名が - のとき
	標準入力から読み込みます。

	オプション

	-<num>	マッチした行の前後を指定した行数表示します。

	-A:	マッチした行の後を指定した行数表示します。
		行数が指定されないときの既定値は 1 行です。
		この既定値は変更できます。

	-B:	マッチした行の前を指定した行数表示します。
		行数が指定されないときの既定値は 1 行です。
		この既定値は変更できます。

	-C:	マッチした行の前後を 2 行ずつ表示します。
		この行数は変更できます。

	-F:	指定した行数の行の行間の改行を無視して検索します。
		行数が指定されないときの既定値は 2 行です。
		この既定値は変更できます。

	-G:	ファイル名をセパレータに表示し行頭には表示しません。

	-H:	起動パスの cgrep.hlp または環境変数 CGREP の HLP:<file name>;
		で指定されたファイルを less.exe または環境変数 CGREP の
		LESS:<command name>; で指定されたページャーで表示します。

		cgrep.hlp の例を添付します。

	-M:	検索パターンとマッチしたすべての部分に mark を付けます。
		サブオプション u を指定すると less でも下線が表示されます。
		サブオプション h を指定すると less でも強調表示されます。
		サブオプションがないときは画面出力では水色の反転になり、
		リダイレクトされているときは <<<、>>> で囲まれます。
		この既定値は変更できます。

	-N:	検索するフィールドを指定します。+ の後の整数部の数の
		フィールド、小数部の数の文字をスキップし - の後の整数部の数の
		フィールド、小数部の数の文字までが検索の範囲です。
		セパレータが既定値のときは +0.m-0.n とすると行頭の空白が
		除かれてしまうのでカラムを指定した検索にはなりません。
		+.m-.n と指定してください。

	-S:	検索パターンが連続した行にあるか検索します。

	-T:	フィールドのセパレータ (1 byte 文字)を指定します。
		エスケープシーケンスとして \s、\t、\ooo、\xhh が使えます。
		既定値は空白、タブのくり返しでこれらはフィールドの一部とは
		みなされません。この既定値は変更できます。

	-W:	指定した行数の行の行間の改行、空白、タブを無視して検索します。
		行数が指定されないときの既定値は 2 行です。
		この既定値は変更できます。

	-Z:	ファジーな(笑)検索をおこないます。パターン中の英文字、数字
		カナ、句読点等の case、1 byte 文字、2 byte 文字、カタカナ、
		ひらがなを区別しないで検索します。

		たとえば -Z "test" とすると "[tTｔＴ][eEｅＥ][sSｓＳ][tTｔＴ]"
		を検索します。

		このとき '\' でエスケープされた文字と '['、']' で括られた
		文字集合はそのまま検索します。

		これは検索パターンを内蔵の変換テーブルによって変換することで
		実現しています。

		デフォールトで変換されるのは 1 バイトの英数字、空白と 2 バイト
		のかな、句読点、音引きです。

		デフォールトの変換以外にも起動パスの cgrep.fuz または
		環境変数 CGREP の FUZ:<file name>; で指定されるファイルから
		次の書式の変換データを読み込んで変換テーブルに追加できます。

イ:[イいヰゐｲ]
エ:[エえヱゑｴ]

		1 バイトの英数字は大文字に、2 バイトのかなはカタカナに正規化
		してから変換テーブルを検索しますから 1 byte 小文字、2 byte
		ひらがなを登録しても無効です。

		サブオプション c を指定すると変換した検索パターンを表示します。
		サブオプション d を指定すると変換テーブルを表示します。

		cgrep.fuz の例を添付します。

		cgrep.fuz 作成用の perl スクリプト mk_fuz.pl を添付します。

	-a:	AND 検索をします。

	-b:	byte offset を表示します。

	-c:	マッチした行数を表示します。ただし、FW オプションが指定されて
		いる場合はマッチした回数を表示します。

	-e:	検索パターンを指定します。- で始まるパターンに使います。
		複数指定できます。また -f オプションとの重複もできます。

	-f:	検索パターンを指定したファイルから読み込みます。
		一行ずつ独立した検索パターンとします。
		複数指定できます。また -e オプションとの重複もできます。
		ファイル名が - のときは標準入力から読み込みます。

	-h:	入力ファイルが複数でもファイル名を表示しません。

	-i:	英文字の大文字小文字を区別しないで検索します。

	-l:	マッチしたファイル名を表示します。

	-n:	行番号を表示します。

	-s:	何も表示せず終了コードを返します。終了コードは
		マッチしたとき 0、マッチしないとき 1、エラーのとき 2 です。

	-t:	filename line_no: のように表示します。

	-v:	検索パターンとマッチしない行を表示します。

	-w:	検索パターンと word として適合する行を表示します。

	-x:	検索パターンと全行が適合する行を表示します。

	-V:	バージョンを表示します。

	入力ファイル名には *、? 以外に次のようなワイルドカードが使えます。

	例	i0003[7-9]	: i00037 と i00038 と i00039
		i0004[012]	: i00040 と i00041 と i00042
		i*[^1-3]	: i で始まって 1、2、3 以外で終わるファイル名
		*.{log,uue}	: 拡張子が log または uue

	ディレクトリの部分にもワイルドカードが使えます。

	ファイル名中の { は \{ としてください。
	ファイル名中の ' は \' としてください。

	環境変数 CGREP に XARGS:NO_SORT; を設定するか、環境変数 XARGS に
	NO_SORT を設定するとワイルドカードを展開したファイル名をソートしません。

	既定値の変更方法

	起動パスの cgrep.cfg または 環境変数 CGREP の CFG:<file name>; で
	指定されるファイルの中に次の例の = の後を変更して記述してください。
	行頭に空白などがあるとその行は無効です。

REGEX=EGREP
T_DEFAULT=\0
A_DEFAULT=1
B_DEFAULT=1
C_DEFAULT=2
F_DEFAULT=2
BGN_UNDERLINE=\033[4m
END_UNDERLINE=\033[m
BGN_HILITE=\033[33m
END_HILITE=\033[m
TTY_BGN_MARK=\033[7;36m
TTY_END_MARK=\033[m
PIPE_BGN_MARK=<<<
PIPE_END_MARK=>>>

	エスケープシーケンスとして \s、\t、\ooo、\xhh、\\ が使えます。

特徴
	GNUish MS-DOS の egrep.exe に比べて1/4 の速さ(遅さ)ですが
	MS 漢字が通ります。
	-e、-f オプションが複数指定可能で AND 検索できます。
	検索パターン中に \n があると複数のパターンと見なされます。
	行間の改行、空白、タブを無視した検索ができます。
	検索パターンにマッチした部分に mark が付けられます。
	ファジーな検索が行えます。
	フィールドを指定した検索ができます。

ソースについて
	getopt.c は `the AT&T public domain source for getopt(3)' を
	改変しました。

	regex.* は GNU diff ver. 1.15 の中の regex.* を serow さんの
	regex.* の日本語化をほぼ丸写しにして改変しました。

	xargs1.c は serow さんの xargs.c を改変しました。

	xsystem.c は serow さんが作られました。

	cgrep.c のなかの test_signal() は serow さんの jgawk の
	main.c のなかのを拝借しました。

	cgrep.hlp は Te.Kim さんが作られたのを Kouzuka さんが修正しました。

	cgrep.fuz は Kouzuka さんが作られました。

	その他は自作です。

使用コンパイラ
	Microsoft-C ver 6.00A でコンパイルしました。

著作権について
	GNU の主張に従います。
	getopt.c、xargs1.c、xsystem.c は PDS です。

無保証
	使用の結果については一切保証しません。

お願い
	バグレポート、ご意見、ご感想よろしくお願いします。

予定
	日本語化の抜けをなくす。
	すこし速くする。

記録
	1991/02/26 ver. 0.0alpha
		pcs の junk.test に post した。

	1991/02/28 ver. 0.1alpha
		検索パターンに '\n' があるときの v オプションの
		バグを修正した。
		pcs の junk.test に post した。

	1991/03/06 ver. 0.2alpha
		t オプションと F オプションと W オプションを付けた。
		pcs の junk.test に post した。

	1991/03/07 ver. 0.3alpha
		おおぼけのバグと F オプションのバグを修正した。
		検索パターンにエスケープシーケンスを使えるようにした。
		ファイル名をソートしないようにできるようにした。
		pcs の junk.test に post した。

	1991/03/08 ver. 0.4alpha
		ver. 0.2 で enbug した F、W オプションなしで B、C オプションを
		使うと異常実行しハングまでするバグを修正した。
		pcs の junk.test に post した。

	1991/03/08 ver. 0.5alpha
		F、W オプションで行数を指定できるようにした。

	1991/03/09 ver. 0.6alpha
		F、W オプションのとき M オプションで mark を付けるようにした。
		pcs の junk.test に post した。

	1991/03/11 ver. 0.7alpha
		F、W オプションのとき以外にも M オプションで mark を付けるよ
		うにした。less に対応するサブオプションを付けた。
		mark を cgrep.cfg で指定できるようにした。
		pcs の junk.test に post した。

	1991/03/14 ver. 0.8alpha
		^C で打ち切ったとき mark を消すようにした。
		pcs の junk.test に post した。

	1991/03/15 ver. 0.9alpha
		^C で打ち切ったときアラームが多数回出るバグを修正した。
		中間の行が mark されないバグを修正した。
		-Mu で画面出力でも下線を表示するようにした。
		-M でリダイレクトしても PIPE の mark にならなくなった
		バグを修正した。
		pcs の junk.test に post した。

	1991/03/17 ver. 1.0alpha
		ABCFW オプションの既定値を cgrep.cfg で設定できるようにした。
		chls オプションを付けた。
		pcs の junk.test に post した。

	1991/03/18 ver. 1.1alpha
		c オプションの非互換性を修正した。c オプションと
		F、W オプションを併用したときのバグを修正した。
		-Mh で画面出力でも mark を表示するようにした。
		こまごまとしたミスを修正した。
		pcs の junk.test に post した。

	1991/03/19 ver. 1.2alpha
		c オプションとF、W オプションを併用したときのバグを修正した。
		pcs の junk.test に post した。

	1991/03/23 ver. 1.3alpha
		Z オプションを付けた。
		pcs の junk.test に post した。

	1991/03/29 ver. 1.4alpha
		Z オプションの仕様を変更した。
		H オプションを付けた。
		cgrep.cfg などのファイルのパスを指定できるようにした。
		pcs の junk.test に post した。

	1991/03/29 ver. 1.5alpha
		cgrep.cfg がないと run-time error R6001
		- null pointer assignment になるバグを修正した。
		pcs の junk.test に post した。

	1991/04/02 ver. 1.6alpha
		c オプションのときもセパレータを表示するバグを修正した。
		suffix の付け替えをサブルーチンにまとめた。
		G オプションを付けた。
		排他的なオプションを重複して指定した場合の矛盾を修正した。

	1991/04/02 ver. 1.7alpha
		オプションの数値パラメータに連続して次のオプションを
		書けるようにした。

	1991/04/27 ver. 1.8beta
		xargs1.c をディレクトリの部分にもワイルドカードが使える版に
		取り替えた。

	1991/04/28
		regex.* の改変部分を明示した。

	1991/04/29
		pcs の junk.test に post した。

	1991/05/03 ver. 1.9beta
		複数の検索パターンを使えるようにした。
		AND 検索できるようにした。
		pcs の junk.test に post した。

	1991/05/08 ver. 2.0
		ドキュメントを修正した。
		pcs の pool msdos に post した。

	1991/05/08 ver. 2.1
		test_signal() によって break off でも ^C にすぐ
		反応するようにした。

	1991/05/11
		pcs の junk.test に post した。

	1991/05/13 ver. 2.2
		Z オプションを使用時に検索文字列として「ー」を指定しても
		「-、ｰ」が検索されないバグを修正した。
		pcs の junk.test に post した。

	1991/05/14 ver. 2.3
		Z オプションを使用時に検索文字列として 1byte カナを指定した
		ときのバグを修正した。
		ドキュメントの Z オプションの記述を修正した。
		pcs の junk.test に post した。

	1991/06/24 ver. 2.4
		配列で参照していたのをポインタで参照するようにした。
		検索文字列が一つのときを別に扱うようにした。
		コンパイルオプションに /Ox を付けたためラージモデルに
		しなければならなかった。

	1992/01/11 ver. 2.5
		入力一行ごとに malloc()、free() していたのを止めた。
		このため多少速くなった。
		エスケープシーケンス \ooo の処理のため \i (i = 1 .. 9) に
		よる括弧内の適合文字列の参照ができなかったバグを修正した。
		pcs の junk.test に post した。

	1992/01/17 ver. 2.6
		可能な場合は bm サーチを先に行うことにした。
		このため多少速くなった。
		pcs の junk.test に post した。

	1992/01/22 ver. 2.7
		ver. 2.6 の i オプションのバグをとりあえず修正した。
		pcs の junk.test に post した。

	1992/01/29 ver. 2.8
		ver. 2.4 以降で FW オプションと M オプションを併用したときに
		マークする位置を誤るバグを修正した。

	1992/01/30
		bm サーチでマッチした位置から re サーチを行うようにした。
		pcs の junk.test に post した。

	1992/02/02 ver. 2.9
		ver. 2.5 以降で入力ファイルの行長が 512 以上のとき
		ハングするバグを修正した。
		pcs の junk.test に post した。

	1992/02/08 ver. 2.91
		検索するフィールドの指定ができるようにした。
		pcs の junk.test に post した。

	1992/02/15 ver. 2.92
		セパレータが既定値のときのフィールドを awk と同じように
		空白を除くようにした。
		f オプションのファイル名が - のとき標準入力から読み込むよう
		にした。
		range が負にならないようにした。
		N オプションを複数指定したとき最後の指定のみを有効にした。
		pcs の junk.test に post した。

	1992/02/18 ver. 2.93
		セパレータが既定値のとき N オプションが指定されていなくても
		行頭の空白が除かれていたバグを修正した。
		pcs の junk.test に post した。

	1992/02/24 ver. 2.94
		フィールド指定の仕様を変えた。
		T オプションの既定値を設定できるようにした。
		pcs の junk.test に post した。

	1992/03/04 ver. 2.95
		GNU grep に倣った正規表現を使えるようにした。

	1992/03/05
		pcs の junk.test に post した。

	1992/03/22 ver. 2.96
		_ も word の要素とした。
		b、w、x オプションを付けた。
		pcs の junk.test に post した。

	1992/04/25 ver. 3.00
		このドキュメントと cgrep.hlp のバグを修正した。
		U8FC-BBS の pool msdos に post した。

	1992/05/03 ver. 3.01
		xargs1.c のディレクトリにワイルドカードを使用すると
		異状動作するバグを修正した。

謝辞
	GNU regex.* を改変して使用しています。

	serow(pcs19614) 氏には xargs.c の改変、再配布を許可いただきました。
	GNU regex.* の日本語化をほぼ丸写しにさせていただきました。
	xsystem.c、test_signal() を使用させていただきました。

	Te.Kim(pcs35023) 氏には検索パターンに '\n' があるときの v オプション
	のバグを報告いただきました。また、エスケープシーケンスの実装の
	要望をいただきました。mark の実装の要望をいただきました。
	複数の検索パターンの要望をいただきました。
	cgrep.hlp を作ってくださいました。

	Sugi(pcs33858) 氏には t オプションを思い出させていただきました。
	また、^C で打ち切ったときの mark の後始末の要望をいただきました。
	-Muh で画面出力でも mark する要望をいただきました。
	既定値の設定の要望をいただきました。
	cgrep.cfg を /etc に置く要望をいただきました。
	AND 検索の要望をいただきました。
	フィールドの仕様に要望をいただきました。
	T オプションの既定値の設定の要望をいただきました。

	Kouzuka(pcs28981) 氏には日本語文脈検索の要望をいただきました。
	また、サンプルデータをいただきました。^C で打ち切ったときの
	mark の後始末の要望をいただきました。^C で打ち切ったときアラームが
	多数回出るバグを報告いただきました。中間の行が mark されないバグを
	報告いただきました。c オプションの要望をいただきました。
	c オプションの非互換性を報告いただきました。c オプションと
	F、W オプションを併用したときのバグを報告いただきました。
	online help の要望をいただきました。
	AND 検索の要望をいただきました。
	cgrep.fuz を作ってくださいました。cgrep.hlp を改訂されました。
	新しい cgrep.hlp を提供くださいました。

	HajimeKJM(pcs33582) 氏には F、W オプションなしで B、C オプションを
	使うと異常実行しハングまでするバグを報告いただきました。
	cgrep.cfg を ~/etc に置く要望をいただきました。

	Daichi(pcs14657) 氏には cfg ファイルのアイデアをいただきました。
	また、ファジーな(笑)検索のアイデア、仕様をいただきました。

	Trace(pcs36476) 氏には h オプションの要望をいただきました。

	Micky(pcs30587) 氏には G オプションの要望をいただきました。

	masakun(pcs06263) 氏には Z オプションを使用時に検索文字列と
	して「ー」を指定しても「ｰ」(アスキーコードB0H)が検索されない
	バグを報告いただきました。また、Z オプションを使用時に検索文字列と
	して 1 byte カナを指定したさいのバグを報告いただきました。
	検索するフィールドの指定の要望をいただきました。

	LEGAPY(pcs33188) 氏には ver. 2.6 で i オプションを付けると
	検索を失敗するバグを報告いただきました。
	また、ver. 2.5 以降で入力ファイルの行長が 512 以上のとき
	ハングするバグを報告いただきました。

	Lupin(pcs26776) 氏には ver. 2.4 以降で FW オプションと M オプションを
	併用したときにマークする位置を誤るバグを報告いただきました。

	Yamashin(pcs34647) 氏にはフィールドの仕様に要望をいただきました。
	また f のファイル名が - のとき標準入力から読み込む要望をいただきました。
	カラム指定の仕様にコメントをいただきました。
	GNU grep に倣った正規表現の要望をいただきました。

	noir(pcs30878) 氏には ver. 2.92 で行頭の空白がマッチしないバグを
	報告いただきました。

	Pen(pcs08512) 氏には regex.c のメモリー参照例外について
	報告いただきました。

	Sa2C(pcs36267) 氏にはこのドキュメントと cgrep.hlp のバグを
	報告いただきました。COPYING についてコメントをいただきました。

	感謝いたします。

AssistantIO(U8FC0010@U8FC-BBS, zob10051@ZOB Station BBS, pcs28337@ascii-net)
